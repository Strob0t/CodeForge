services:
  docs-mcp-server:
    image: ghcr.io/arabold/docs-mcp-server:latest
    container_name: codeforge-docs-mcp
    ports:
      - "6280:6280"
    volumes:
      - ./:/docs:ro
      - ./.devdata/docs_mcp_data:/data
    environment:
      - OPENAI_API_BASE=${DOCS_MCP_API_BASE:-http://host.docker.internal:1234/v1}
      - OPENAI_API_KEY=${DOCS_MCP_API_KEY:-lmstudio}
      - DOCS_MCP_EMBEDDING_MODEL=${DOCS_MCP_EMBEDDING_MODEL:-text-embedding-qwen3-embedding-8b}
      - DOCS_MCP_TELEMETRY=false
    command: ["--protocol", "http", "--host", "0.0.0.0", "--port", "6280"]
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - codeforge-mcp

  playwright-mcp:
    image: mcr.microsoft.com/playwright:v1.57.0-jammy
    container_name: codeforge-playwright
    ipc: host
    shm_size: "1gb"
    volumes:
      - ./.devdata/playwright-mcp:/config
    command:
      - sh
      - -c
      - |
        npx playwright install --with-deps chromium &&
        exec npx @playwright/mcp@latest \
          --config /config/playwright-mcp.json \
          --headless \
          --no-sandbox \
          --isolated
    ports:
      - "8001:8001"
    networks:
      - codeforge-mcp

networks:
  codeforge-mcp:
    driver: bridge
    name: codeforge_mcp
